# prd-execute 命令

## 功能描述
执行产品需求方案，进行版本管理，并完整实施开发流程。自动检查方案可行性，更新 PRD 文档，切分任务并按顺序执行，最后进行整体检查。

## 使用方式
```bash
prd-execute "方案内容描述"
```

## 参数
- `ARGUMENT`: 要执行的方案内容和需求描述

## 权限配置
允许访问所有工具和文件操作权限，包括：
- PRD 文档读写操作
- 代码文件修改权限
- 版本管理和时间戳
- 任务执行和状态追踪
- 项目结构分析

## 执行流程

### 1. 方案分析和验证阶段
- **深度分析方案**: 理解需求细节和技术约束
- **技术可行性检查**: 验证技术栈兼容性和实现难度
- **影响范围分析**: 识别受影响的模块和文件
- **冲突检测**: 检查是否会影响其他不相关模块
- **风险评估**: 评估潜在问题和解决方案

### 2. 版本管理
- **版本号自增**: 自动读取当前版本并递增
- **时间戳生成**: 创建准确的版本时间标记
- **变更日志**: 记录本次更新的详细内容

### 3. PRD 文档更新
- **顶部版本区域**: 在 prd.md 顶部添加新版本信息
- **产品需求更新**: 详细描述新增功能和改进
- **ASCII 原型图**: 生成直观的系统架构图
- **技术架构要点**: 记录关键技术决策和实现要点

### 4. 任务执行流程
- **任务分解**: 将方案切分为合理的 todolist
- **优先级排序**: 根据依赖关系确定执行顺序
- **顺序执行**: 严格按照 todolist 逐一实现
- **进度跟踪**: 实时更新任务状态
- **错误处理**: 遇到问题时提供解决方案

### 5. 整体检查 (ultrathink)
- **功能完整性**: 验证所有需求是否完整实现
- **代码质量**: 检查代码规范和最佳实践
- **性能影响**: 评估对系统性能的影响
- **兼容性测试**: 确保不破坏现有功能
- **文档同步**: 确保文档和代码保持一致

## PRD 文档结构模板

```markdown
# 产品需求文档 (PRD)

## 📝 版本更新历史

### v{VERSION} - {TIMESTAMP}
#### 🚀 新增功能
- [产品需求更新内容]

#### 📊 系统架构
```
┌─────────────────────────────────────────┐
│           ASCII 原型图展示               │
│        [具体的架构和流程图]              │
└─────────────────────────────────────────┘
```

#### 🔧 技术要点
- 涉及的技术栈和框架
- 架构设计原则
- 实现注意事项

#### 📋 实施清单
- [x] 已完成的任务
- [ ] 待执行的任务

---

### 历史版本
[之前版本的记录...]
```

## 命令实现

```markdown
用方案{ARGUMENT},这个版本号自增。

请注意再次检查按照此方开发后是否能完整实现需求，并且不影响其他不相关模块，如果有，请重新指定方案并和我同步。

如果一切可以正常实现，在prd.md文档顶部新版本更新区域,撰写对应的产品需求更新,对应的ASCII原型图，以及涉及到的技术架构和要点更新,然后后续的开发严格遵循此次更新，再将代码实现切分为合理的todolist,按顺序执行,执行完毕后自己做整体检查 ultrathink
```

## 执行算法

### 版本号管理算法
```
1. 读取 prd.md 文件
2. 解析当前最新版本号 (格式: v1.2.3)
3. 根据变更类型递增版本:
   - 主要功能: 主版本号 +1
   - 新增功能: 次版本号 +1
   - 修复优化: 修订版本号 +1
4. 生成新版本号和时间戳
```

### 方案验证算法
```
1. 解析方案中的技术需求
2. 检查项目现有技术栈兼容性
3. 分析文件和模块影响范围
4. 评估性能和安全影响
5. 生成风险评估报告
```

### 任务分解算法
```
1. 识别方案中的核心功能点
2. 分析功能间的依赖关系
3. 按技术层级分组任务:
   - 数据层 (Model, Repository)
   - 业务层 (ViewModel, Service)
   - 表现层 (UI, Widget)
4. 设置执行优先级和顺序
```

## 示例用法

```bash
prd-execute "实现用户个人资料编辑功能，包括头像上传、信息修改和数据验证，支持实时预览和撤销操作"
```

### 期望输出流程:

1. **方案验证**: 分析个人资料编辑功能的技术可行性
2. **版本管理**: 版本号从 v1.2.0 自增到 v1.3.0
3. **PRD 更新**: 在文档顶部添加新版本信息和架构图
4. **任务分解**:
   - 创建用户资料 Model 和 Repository
   - 实现头像上传 ViewModel 和 Service
   - 设计个人资料编辑页面 UI
   - 添加数据验证和预览功能
5. **顺序执行**: 按依赖关系逐一实现各个任务
6. **整体检查**: 功能测试、性能评估、兼容性验证

## 特性优势

- **自动化流程**: 从方案到实施的完整自动化
- **版本管控**: 规范的版本管理和变更追踪
- **风险控制**: 多重检查确保不影响现有功能
- **文档同步**: PRD 文档与代码实现保持同步
- **质量保证**: ultrathink 深度检查确保实施质量
- **可追溯性**: 完整记录开发过程和决策依据
